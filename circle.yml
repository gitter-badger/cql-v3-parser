dependencies:
  cache_directories:
    - ~/.sbt
    - ~/.ivy2
    - ~/.m2
  pre:
    - mkdir -p ~/.bintray && envsubst < .credentials > ~/.bintray/.credentials
    - java -version
    - cd environment && docker build -t sxend/test-cassandra .
    - cd environment && export CONTAINER_ID=`docker run -d -t -i -p 9042:9042 sxend/test-cassandra`; export CONTAINER_IP=`docker inspect --format ' {{ .NetworkSettings.IPAddress }} ' $CONTAINER_ID` ; while sleep 2 ;do DONE_ROWS=`echo "select * from test.done;" | $CASSANDRA_HOME/bin/cqlsh $CONTAINER_IP| wc -l` 2>/dev/null ; if [ $DONE_ROWS -eq 7 ] ; then break ;fi ;done ; cd .. ;envsubst < ./test.properties.template > ./src/test/resources/test.properties
machine:
  java:
    version: oraclejdk8
deployment:
  release:
    branch: master
    commands:
      - sbt clean +compile +package +publish